<!DOCTYPE html>
<html lang="sk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mini E-shop asitynormalny</title>
<script src="https://js.stripe.com/v3/"></script>
<style>
  body { font-family: sans-serif; margin:0; padding:0; background:#000; color:#fff; text-align:center;}
  
  /* HLAVIƒåKA */
  header {
    padding:15px 20px;
    background:#111;
    box-shadow:0 2px 5px rgba(255,255,255,0.1);
    display:grid;
    grid-template-columns:1fr auto 1fr;
    align-items:center;
  }

  header img {
    max-width:400px;   /* v√§ƒç≈°ie logo na desktop */
    width:80%;         /* flexibiln√© pre men≈°ie obrazovky */
    height:auto;       /* zachovanie proporci√≠ */
    justify-self:center;
  }

  .cart-icon {
    font-size:20px;
    cursor:pointer;
    position:relative;
    user-select:none;
    color:white;
    display:flex;
    align-items:center;
    gap:6px;
    justify-self:end;
  }

  .cart-badge{background:red; color:white; border-radius:20px; padding:2px 6px; font-size:13px;}
  .cart-price{font-size:13px; color:#0f0;}

  @media (max-width:600px){
    header {
      grid-template-columns:1fr;
      grid-template-rows:auto auto;
      justify-items:center;
      gap:10px;
    }
    header img{
      max-width:300px; /* v√§ƒç≈°ie logo na mobile */
      width:90%;
    }
    .cart-icon{
      justify-self:center; /* ikona pod logom */
    }
  }

  .product{margin:30px auto; background:#111; padding:20px; max-width:400px; box-shadow:0 2px 5px rgba(255,255,255,0.2); border-radius:10px;}
  .carousel{position:relative; margin-bottom:15px;}
  .carousel img{max-width:100%; display:block; border-radius:5px;}
  .arrow{position:absolute; top:50%; transform:translateY(-50%); font-size:30px; color:#fff; cursor:pointer; user-select:none; background:rgba(0,0,0,0.4); padding:5px 10px; border-radius:5px;}
  .arrow.left{left:-10px;} .arrow.right{right:-10px;}
  .size-container, .qty-container{margin:15px 0;}
  .size-container label, .qty-container label{display:block; margin-bottom:5px; font-size:16px;}
  .size-container select, .qty-container input{width:50%; padding:10px; font-size:16px; border-radius:5px; border:none; text-align:center;}
  .product button{padding:10px 20px; font-size:16px; cursor:pointer; background:#6772e5; color:#fff; border:none; border-radius:5px; margin-top:10px;}
  
  /* Ko≈°√≠k */
  .cart-modal{display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); z-index:999; justify-content:center; align-items:center;}
  .cart{
    background:#111;
    padding:15px 20px;
    max-width:420px;
    width:90%;
    border-radius:10px;
    box-shadow:0 2px 10px rgba(255,255,255,0.3);
    position:relative;
    text-align:center;
    max-height:90vh;
    overflow-y:auto;
  }
  .cart input, .cart select, .cart textarea{
    width:90%;
    padding:6px;
    margin:5px 0;
    font-size:14px;
    border-radius:4px;
    border:none;
  }
  .cart textarea{resize:vertical; min-height:50px;}
  .cart button{padding:8px 16px; font-size:15px; cursor:pointer; background:#6772e5; color:#fff; border:none; border-radius:5px; margin-top:10px;}
  .close-btn{position:absolute; top:10px; right:15px; font-size:20px; color:#fff; cursor:pointer;}
  .remove-item{cursor:pointer; color:red; margin-left:8px; font-weight:bold;}
  label{display:block; margin-top:6px;}
</style>
</head>
<body>

<header>
  <div></div>
  <img src="DWDasitynormalny.jpg" alt="Logo">
  <div id="cartIcon" class="cart-icon">
    üõí <span id="cartCount" class="cart-badge">0</span>
    <span id="cartTotal" class="cart-price">0 ‚Ç¨</span>
  </div>
</header>

<div class="product">
  <h2>Shirt</h2>
  <div class="carousel">
    <span class="arrow left" id="prev">&#10094;</span>
    <img src="poster 001.jpg" id="productImg" alt="Triƒçko">
    <span class="arrow right" id="next">&#10095;</span>
  </div>

  <div class="size-container">
    <label for="size">Size:</label>
    <select id="size">
      <option value="M" selected>M</option>
      <option value="L">L</option>
      <option value="XL">XL</option>
    </select>
  </div>

  <div class="qty-container">
    <label for="quantity">Poƒçet kusov:</label>
    <input type="number" id="quantity" value="1" min="1">
  </div>

  <p>Cena: 23 ‚Ç¨</p>
  <p>Product Description: 100% cotton oversize unisex shirt and high quality screen printing.</p>
  <button id="addToCart">Prida≈• do ko≈°√≠ka</button>
</div>

<div class="cart-modal" id="cartModal">
  <div class="cart" id="cart">
    <span class="close-btn" id="closeCart">&times;</span>
    <h3>Ko≈°√≠k</h3>
    <div id="cartItems"></div>
    <p id="total"></p>

    <input type="text" id="name" placeholder="Meno a priezvisko">
    <input type="email" id="email" placeholder="Email">
    <input type="tel" id="phone" placeholder="Telef√≥n">
    <input type="text" id="street" placeholder="Ulica a popisn√© ƒç√≠slo">
    <input type="text" id="zip" placeholder="PSƒå">

    <textarea id="note" placeholder="Pozn√°mka k objedn√°vke"></textarea>

    <select id="country">
      <option value="Slovensko" selected>Slovensko</option>
      <option value="ƒåesk√° republika">ƒåesk√° republika</option>
    </select>

    <label for="delivery">Packeta Sp√¥sob doruƒçenia:</label>
    <select id="delivery">
      <option value="V√Ωdajn√© miesto">V√Ωdajn√© miesto</option>
      <option value="Z-Box">Z-Box</option>
    </select>

    <label>
      <input type="checkbox" id="cod"> Platba dobierkou
    </label>

    <button id="payBtn">Objednat s povinostou platby</button>
  </div>
</div>

<script>
  const images = ["trikomore.jpg","0001.jpg","2006.jpg"];
  let current = 0;
  let shipping = 3.80;

  const productImg = document.getElementById("productImg");
  document.getElementById("prev").addEventListener("click", () => {
    current = (current - 1 + images.length) % images.length;
    productImg.src = images[current];
  });
  document.getElementById("next").addEventListener("click", () => {
    current = (current + 1) % images.length;
    productImg.src = images[current];
  });

  const cartModal = document.getElementById("cartModal");
  const cartItems = document.getElementById("cartItems");
  const total = document.getElementById("total");
  const closeCart = document.getElementById("closeCart");
  const cartIcon = document.getElementById("cartIcon");
  const cartCount = document.getElementById("cartCount");
  const cartTotal = document.getElementById("cartTotal");
  const countrySelect = document.getElementById("country");

  let cartData = [];

  function updateShipping() {
    const country = countrySelect.value;
    shipping = (country === "ƒåesk√° republika") ? 4.50 : 3.50;
  }

  function renderCart() {
    updateShipping();

    if(cartData.length === 0){
      cartItems.innerHTML = "<em>Ko≈°√≠k je pr√°zdny</em>";
      total.innerHTML = "";
      cartCount.textContent = 0;
      cartTotal.textContent = "0 ‚Ç¨";
      return;
    }

    cartItems.innerHTML = cartData.map((item, index) =>
      `<p>
        ${item.product} (${item.size}) x${item.qty} - ${(item.price*item.qty).toFixed(2)} ‚Ç¨
        <span class="remove-item" data-index="${index}">‚ùå</span>
      </p>`
    ).join('');

    const subtotal = cartData.reduce((sum,i)=>sum+i.price*i.qty,0);
    const totalQty = cartData.reduce((sum,i)=>sum+i.qty,0);
    const totalPrice = (subtotal + shipping).toFixed(2);

    total.innerHTML = `Medzis√∫ƒçet: ${subtotal.toFixed(2)} ‚Ç¨<br>Po≈°tovn√©: ${shipping.toFixed(2)} ‚Ç¨<br><strong>Celkom: ${totalPrice} ‚Ç¨</strong>`;

    cartCount.textContent = totalQty;
    cartTotal.textContent = subtotal.toFixed(2) + " ‚Ç¨";

    document.querySelectorAll(".remove-item").forEach(btn => {
      btn.addEventListener("click", () => {
        const index = btn.getAttribute("data-index");
        cartData.splice(index, 1);
        renderCart();
      });
    });
  }

  cartIcon.addEventListener("click", () => {
    renderCart();
    cartModal.style.display = "flex";
  });

  document.getElementById("addToCart").addEventListener("click", () => {
    const size = document.getElementById("size").value;
    const qty = parseInt(document.getElementById("quantity").value) || 1;

    cartData.push({product:"Triƒçko", size:size, price:23, qty:qty});
    renderCart();
  });

  closeCart.addEventListener("click", () => { cartModal.style.display = "none"; });
  cartModal.addEventListener("click", (e) => { if(e.target === cartModal){ cartModal.style.display = "none"; } });

  countrySelect.addEventListener("change", renderCart);

  const stripe = Stripe("pk_test_51S6pNePGHBZZTxG0aYb3hsSIiy4Ge09SYeI1xg1mNqwM453Rm9NEE0Y4pO9S7m3AxZEcE4QrxcNnPgcPynVkraBY001L9Om4Pt");
  const payBtn = document.getElementById("payBtn");

  payBtn.addEventListener("click", async () => {
    if(cartData.length === 0){
      alert("Ko≈°√≠k je pr√°zdny!");
      return;
    }

    const name = document.getElementById("name").value.trim();
    const email = document.getElementById("email").value.trim();
    const phone = document.getElementById("phone").value.trim();
    const street = document.getElementById("street").value.trim();
    const zip = document.getElementById("zip").value.trim();
    const country = document.getElementById("country").value;
    const note = document.getElementById("note").value.trim();
    const delivery = document.getElementById("delivery").value;
    const cod = document.getElementById("cod").checked;

    if(!cod && (delivery === "V√Ωdajn√© miesto" || delivery === "Z-Box")){
      alert("Pre doruƒçenie na V√Ωdajn√© miesto alebo Z-Box mus√≠te zvoli≈• dobierku!");
      return;
    }

    if(!name || !email || !phone || !street || !zip){
      alert("Vypl≈à v≈°etky povinn√© polia!");
      return;
    }

    const res = await fetch("/.netlify/functions/create-checkout", {
      method: "POST",
      body: JSON.stringify({ 
        quantity: cartData.reduce((sum,i)=>sum+i.qty,0),
        customer: { name, email, phone, street, zip, country, note, delivery, cod }
      })
    });

    const data = await res.json();
    await stripe.redirectToCheckout({ sessionId: data.id });
  });
</script>

</body>
</html>
